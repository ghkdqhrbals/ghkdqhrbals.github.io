<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="실시간 채팅방 구현(17) - (프론트 서버 개발 완료 및 성능이슈 발생)" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="INDEX Batch JPA batch JDBC batch 일반적인 성능비교 그래서 Chatting을 insert할 때는 어떤 방식이 좋을까? 이슈비교 그 외 종합 성능비교 그래프 결론" /><meta property="og:description" content="INDEX Batch JPA batch JDBC batch 일반적인 성능비교 그래서 Chatting을 insert할 때는 어떤 방식이 좋을까? 이슈비교 그 외 종합 성능비교 그래프 결론" /><link rel="canonical" href="/posts/chatting(17)/" /><meta property="og:url" content="/posts/chatting(17)/" /><meta property="og:site_name" content="Austin" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-24T01:00:25+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="실시간 채팅방 구현(17) - (프론트 서버 개발 완료 및 성능이슈 발생)" /><meta name="twitter:site" content="@ghkdqhrbals" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-29T08:19:41+00:00","datePublished":"2023-01-24T01:00:25+00:00","description":"INDEX Batch JPA batch JDBC batch 일반적인 성능비교 그래서 Chatting을 insert할 때는 어떤 방식이 좋을까? 이슈비교 그 외 종합 성능비교 그래프 결론","headline":"실시간 채팅방 구현(17) - (프론트 서버 개발 완료 및 성능이슈 발생)","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/chatting(17)/"},"url":"/posts/chatting(17)/"}</script><title>실시간 채팅방 구현(17) - (프론트 서버 개발 완료 및 성능이슈 발생) | Austin</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Austin"><meta name="application-name" content="Austin"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/avatar/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Austin</a></div><div class="site-subtitle font-italic"> Record every seconds</div><div class="site-subtitle"> <a href="https://ghkdqhrbals.github.io/portfolios/" class="mx-auto" style="color: #ffd700"> See my portfolio </a></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>정보</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ghkdqhrbals" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ghkdqhrbals','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>실시간 채팅방 구현(17) - (프론트 서버 개발 완료 및 성능이슈 발생)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>실시간 채팅방 구현(17) - (프론트 서버 개발 완료 및 성능이슈 발생)</h1><div class="post-meta text-muted"> <span> 게시 <em class="" data-ts="1674522025" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-01-24 </em> </span> <span> 업데이트 <em class="" data-ts="1674980381" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-01-29 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/ghkdqhrbals">ghkdqhrbals</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1345 단어"> <em>7 분</em>읽는 시간</span></div></div></div><div class="post-content"><h1 id="index">INDEX</h1><ul><li><a href="#batch">Batch</a><ul><li><a href="#jpa-batch">JPA batch</a><li><a href="#jdbc-batch">JDBC batch</a><li>일반적인 성능비교</ul><li>그래서 Chatting을 insert할 때는 어떤 방식이 좋을까?<ul><li>이슈비교<li>그 외<li>종합 성능비교 그래프</ul><li>결론</ul><p>기능 설명 및 시연영상 <a href="https://www.youtube.com/watch?v=3VqwZ17XyEQ&amp;t=237s">https://www.youtube.com/watch?v=3VqwZ17XyEQ&amp;t=237s</a></p><p>현재는 4.2.0 버전이며 프론트 서버까지 모두 완료되었다!</p><p>이후, 실제 트래픽양이 많은 chat을 이전에 만들어둔 <a href="https://github.com/ghkdqhrbals/multiple-restapi-request-test">Go 프로그램</a>으로 테스트 해보았더니, 아래와 같이 성능결과가 암울했다. 약 <strong>10K개의 채팅을 수용하는데 80초가 소요</strong>된 것이다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>test-multiple-http-request | Request url: http://127.0.0.1:8060/chat/chat
test-multiple-http-request | The number of HTTP Requests: 10000
test-multiple-http-request | The number of threads: 100
test-multiple-http-request | Proceeding! Please wait until getting all the responses
test-multiple-http-request | Elapsed Time: 80.02316758
test-multiple-http-request | Response status code:  200 , How many?:  10000
</pre></table></code></div></div><p>그래서 우리는 <strong>Batch</strong>를 사용해서 이를 개선해볼 것이다.</p><h2 id="batch"><span class="mr-2">Batch</span><a href="#batch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>배치는 특정 사이즈만큼 리스트에 저장하고 송출하는 방식이다. 여기는 JPA, JDBC 두 가지 방식이 있는데, 아래는 각각을 설명한다.</p><h3 id="jpa-batch"><span class="mr-2">JPA batch</span><a href="#jpa-batch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>JPA의 batch는 여러개의 TX를 모아서 전송함으로써 <strong>네트워크 딜레이 로드를 줄이는 방식</strong>이다.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">-- JPA Batch=4 설정</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span>
<span class="p">(</span><span class="n">TITLE</span><span class="p">,</span> <span class="n">CREATED_TS</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span>
<span class="k">VALUES</span>
 <span class="p">(</span><span class="s1">'test1'</span><span class="p">,</span> <span class="k">LOCALTIMESTAMP</span><span class="p">,</span> <span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span>
<span class="p">(</span><span class="n">TITLE</span><span class="p">,</span> <span class="n">CREATED_TS</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span>
<span class="k">VALUES</span>
 <span class="p">(</span><span class="s1">'test2'</span><span class="p">,</span> <span class="k">LOCALTIMESTAMP</span><span class="p">,</span> <span class="mi">101</span><span class="p">.</span><span class="mi">10</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span>
<span class="p">(</span><span class="n">TITLE</span><span class="p">,</span> <span class="n">CREATED_TS</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span>
<span class="k">VALUES</span>
 <span class="p">(</span><span class="s1">'test3'</span><span class="p">,</span> <span class="k">LOCALTIMESTAMP</span><span class="p">,</span> <span class="mi">102</span><span class="p">.</span><span class="mi">10</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span>
<span class="p">(</span><span class="n">TITLE</span><span class="p">,</span> <span class="n">CREATED_TS</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span>
<span class="k">VALUES</span>
 <span class="p">(</span><span class="s1">'test4'</span><span class="p">,</span> <span class="k">LOCALTIMESTAMP</span><span class="p">,</span> <span class="mi">103</span><span class="p">.</span><span class="mi">10</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="jdbc-batch"><span class="mr-2">JDBC batch</span><a href="#jdbc-batch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>JPA의 batch는 그냥 여러개의 TX를 모아서 전송하는 느낌인 반면에, JDBC Batch는 실제 쿼리를 튜닝하여 좀더 로우 레벨에서 insert한다.</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">-- JDBC Batch=4 사용</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCT</span>
<span class="p">(</span><span class="n">TITLE</span><span class="p">,</span> <span class="n">CREATED_TS</span><span class="p">,</span> <span class="n">PRICE</span><span class="p">)</span>
<span class="k">VALUES</span>
 <span class="p">(</span><span class="s1">'test1'</span><span class="p">,</span> <span class="k">LOCALTIMESTAMP</span><span class="p">,</span> <span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">'test2'</span><span class="p">,</span> <span class="k">LOCALTIMESTAMP</span><span class="p">,</span> <span class="mi">101</span><span class="p">.</span><span class="mi">10</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">'test3'</span><span class="p">,</span> <span class="k">LOCALTIMESTAMP</span><span class="p">,</span> <span class="mi">102</span><span class="p">.</span><span class="mi">10</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">'test4'</span><span class="p">,</span> <span class="k">LOCALTIMESTAMP</span><span class="p">,</span> <span class="mi">104</span><span class="p">.</span><span class="mi">10</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="일반적인-성능비교"><span class="mr-2">일반적인 성능비교</span><a href="#일반적인-성능비교" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>--------------------------------------------------
Regular inserts     |    1         |          15ms
Batch inserts       |    1         |          10ms
Total gain: 33 %
--------------------------------------------------
Regular inserts     |    10        |           3ms
Batch inserts       |    10        |           2ms
Total gain: 33 %
--------------------------------------------------
Regular inserts     |    100       |          42ms
Batch inserts       |    100       |          10ms
Total gain: 76 %
--------------------------------------------------
Regular inserts     |    1000      |         141ms
Batch inserts       |    1000      |          19ms
Total gain: 86 %
--------------------------------------------------
Regular inserts     |    10000     |         827ms
Batch inserts       |    10000     |         104ms
Total gain: 87 %
--------------------------------------------------
Regular inserts     |    100000    |        5093ms
Batch inserts       |    100000    |         981ms
Total gain: 80 %
--------------------------------------------------
Regular inserts     |    1000000   |       50482ms
Batch inserts       |    1000000   |        9821ms
Total gain: 80 %
--------------------------------------------------
</pre></table></code></div></div><p>JPA batch는 1초에 약 2만개의 insert 쿼리를 처리할 수 있는 반면에, JDBC batch는 약 1초에 10만개의 insert 쿼리를 처리할 수 있다.</p><h2 id="그래서-chatting을-insert할-때는-어떤-방식이-좋을까"><span class="mr-2">그래서 Chatting을 insert할 때는 어떤 방식이 좋을까?</span><a href="#그래서-chatting을-insert할-때는-어떤-방식이-좋을까" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="이슈비교"><span class="mr-2">이슈비교</span><a href="#이슈비교" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>캐싱 성능<ul><li><strong>JPA 승리</strong>. 현재 Chatting이 많을 경우 이를 불러오는 부분에서 많은 네트워크 로드가 걸린다. JPA는 영속성을 활용해서 캐싱을 지원하기에 성능이득을 볼 수 있다.</ul><li>네트워크 로드<ul><li>JPA, JDBC 둘 다 쿼리를 모아두었다가 보내기에 <strong>비슷</strong>하다. 다만 JDBC의 패킷 크기가 조금 작다.</ul><li>DB 병렬지원 시 성능<ul><li>만약 DB가 병렬지원한다면, <strong>JPA 승리</strong>. 개별쿼리를 가지기 떄문에 DB가 병렬로 실행시킬 수 있기 때문이다. postgres는 <code class="language-plaintext highlighter-rouge">max_parallel_workers</code> 로 병렬쿼리실행을 지원한다.</ul><li>DB 컨트롤 능력<ul><li><strong>JDBC 승리</strong>. JPA도 물론 네이티브 쿼리 및 여러가지 설정을 할 순 있지만, 기본적으로 JDBC 위에서 동작하기 떄문에 로우 레벨인 JDBC가 승리할 수 밖에 없다.</ul><li>쿼리 실행 속도<ul><li><strong>JDBC 승리</strong>. DB 병렬을 극한까지 사용하지 않으면 JDBC 승리.</ul></ul><h3 id="그-외"><span class="mr-2">그 외</span><a href="#그-외" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>fine-grain<ul><li><strong>JPA 승리</strong>. JDBC 보다 사용하기가 훨씬 간편하다.</ul><li>동시성 문제발생?<ul><li>JDBC batch 사용하기 위해서는 요청을 차곡차곡 쌓을 리스트가 필요하다. 이 때, 리스트는 thread safe해야한다. 그 이유는 아래와 같다. 그리고 여기서 <strong>병목현상이 발생</strong>할 수 있다.</ul><blockquote><p>우리는 @Service 어노테이션을 사용하여 싱글톤으로 생성했다. 얘네는 자원을 힙에다 두고 공유하는 방식이다. 그런데 우리는 멀티 스레드로 서비스의 공유자원을 사용하기때문에 동시접근 문제가 발생한다. 따라서 batch size만큼 저장하는 리스트는 mutex가 지원되는 리스트를 사용해야만 한다.</p></blockquote></ul><h3 id="종합-성능비교-그래프"><span class="mr-2">종합 성능비교 그래프</span><a href="#종합-성능비교-그래프" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Regular <img data-src="../../assets/img/db/b.webp" alt="img" data-proofer-ignore><li>Batch <img data-src="../../assets/img/db/a.webp" alt="img" data-proofer-ignore></ul><blockquote><p>실험환경</p><ul><li>Batch=100 사용<li>레코드는 synchronously 하게 배치에 추가된다</ul></blockquote><p>다 따지고 봤을 때, JDBC가 약 4%정도 성능이 뛰어나다.</p><p>reference <a href="https://medium.com/walmartglobaltech/a-cruncher-choice-jpa-or-jdbc-85c589f584a9">https://medium.com/walmartglobaltech/a-cruncher-choice-jpa-or-jdbc-85c589f584a9</a></p><h2 id="결론"><span class="mr-2">결론</span><a href="#결론" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>필자는 JPA를 사용할 것이다. 아무래도 채팅기록을 받아올 때, 캐싱된 값을 받아올 수 있어 성능이점을 가지기 때문이다. 그리고 무엇보다도 쓰기가 정말정말 편하기 때문에 JPA를 선택하였다. 다음 포스팅에서는 JPA batch를 통한 성능개선 방법을 소개한다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EC%B1%84%ED%8C%85%EC%84%9C%EB%B2%84-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/'>채팅서버 프로젝트</a>, <a href='/categories/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%A7%84%ED%96%89/'>프로젝트 진행</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%EC%8B%A4%EC%8B%9C%EA%B0%84+%EC%B1%84%ED%8C%85%EB%B0%A9+%EA%B5%AC%ED%98%84%2817%29+-+%28%ED%94%84%EB%A1%A0%ED%8A%B8+%EC%84%9C%EB%B2%84+%EA%B0%9C%EB%B0%9C+%EC%99%84%EB%A3%8C+%EB%B0%8F+%EC%84%B1%EB%8A%A5%EC%9D%B4%EC%8A%88+%EB%B0%9C%EC%83%9D%29+-+Austin&url=%2Fposts%2Fchatting%2817%29%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%EC%8B%A4%EC%8B%9C%EA%B0%84+%EC%B1%84%ED%8C%85%EB%B0%A9+%EA%B5%AC%ED%98%84%2817%29+-+%28%ED%94%84%EB%A1%A0%ED%8A%B8+%EC%84%9C%EB%B2%84+%EA%B0%9C%EB%B0%9C+%EC%99%84%EB%A3%8C+%EB%B0%8F+%EC%84%B1%EB%8A%A5%EC%9D%B4%EC%8A%88+%EB%B0%9C%EC%83%9D%29+-+Austin&u=%2Fposts%2Fchatting%2817%29%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fchatting%2817%29%2F&text=%EC%8B%A4%EC%8B%9C%EA%B0%84+%EC%B1%84%ED%8C%85%EB%B0%A9+%EA%B5%AC%ED%98%84%2817%29+-+%28%ED%94%84%EB%A1%A0%ED%8A%B8+%EC%84%9C%EB%B2%84+%EA%B0%9C%EB%B0%9C+%EC%99%84%EB%A3%8C+%EB%B0%8F+%EC%84%B1%EB%8A%A5%EC%9D%B4%EC%8A%88+%EB%B0%9C%EC%83%9D%29+-+Austin" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs-information/">CS information</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/msa/">msa</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/restful/">RESTFUL</a> <a class="post-tag" href="/tags/token/">token</a> <a class="post-tag" href="/tags/database/">database</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/chatting(10)/"><div class="card-body"> <em class="small" data-ts="1673136025" data-df="YYYY-MM-DD" > 2023-01-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>실시간 채팅방 구현(10) - (양방향 DB Sync 구현의 어려움 + 비용)</h3><div class="text-muted small"><p> 서론 단방향까지는 구현이 가능했었는데, 양방향(BDR)은 아래의 이유로 굉장히 까다로웠다. 컨셉만 존재할 뿐, 코드 레퍼런스가 없다. 현업자분들께 방향성을 여쭙고싶다. 두 개의 마스터 노드일 때는 그래도 할 순 있겠지만, 그 이상일 때는 각각을 전부다 설정해줘야하기때문에 상당히 까다롭다. ...</p></div></div></a></div><div class="card"> <a href="/posts/chatting(11)/"><div class="card-body"> <em class="small" data-ts="1673740825" data-df="YYYY-MM-DD" > 2023-01-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>실시간 채팅방 구현(11) - (대량 Rest api test 코드)</h3><div class="text-muted small"><p> 현재까지 auth/chat Server 및 여러 장애대응과 모니터링 서비스를 구축했다. 서비스관련 테스트 코드는 이미 생성하였으며, 이제는 다량의 Rest api 트래픽을 테스트를 위한 클라이언트를 제작해 볼 차례이다. 아래의 코드는 Golang으로 제작하였다. 예상되는 아래의 질문에 대한 답변을 준비해봤다. Question : 왜 Java...</p></div></div></a></div><div class="card"> <a href="/posts/chatting(12)/"><div class="card-body"> <em class="small" data-ts="1673740825" data-df="YYYY-MM-DD" > 2023-01-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>실시간 채팅방 구현(12) - (대량 Rest api test 한계 돌파)</h3><div class="text-muted small"><p> INDEX 랜덤값으로 test하는 code 10000개 rest api 트래픽 실행(110초 소요) 이제 동시 연결가능한 TCP 소켓을 필자의 맥북이 버틸 수 있는만큼 열어서 다량의 http request를 서버로 전송해볼려고 한다. t := http.DefaultTransport.(*http.Transport).Clone() t.M...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/chatting(16)/" class="btn btn-outline-primary" prompt="이전 글"><p>실시간 채팅방 구현(16) - (프론트 서버의 예상 UI + 시퀀스 다이어그램 + HTTP 송/수신 방법 정의)</p></a> <a href="/posts/chatting(18)/" class="btn btn-outline-primary" prompt="다음 글"><p>실시간 채팅방 구현(18) - (성능개선 사안들 및 적용된 값)</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs-information/">CS information</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/msa/">msa</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/restful/">RESTFUL</a> <a class="post-tag" href="/tags/token/">token</a> <a class="post-tag" href="/tags/database/">database</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ghkdqhrbals">ghkdqhrbals</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">새 버전의 콘텐츠를 사용할 수 있습니다.</p><button type="button" class="btn btn-primary" aria-label="Update"> 업데이트 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-VTR1DF5BPL"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-VTR1DF5BPL'); }); </script>
