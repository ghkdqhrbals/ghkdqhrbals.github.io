<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Relationship between MSA &amp; Docker(proceeding)" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="MSA rises as cloud services and is more and more used. That’s because each service is independent and can be managed its cost efficiently. Also, even without the benefits of cost in cloud service, MSA has advantage of scalability, fast dev., increased team autonomy etc." /><meta property="og:description" content="MSA rises as cloud services and is more and more used. That’s because each service is independent and can be managed its cost efficiently. Also, even without the benefits of cost in cloud service, MSA has advantage of scalability, fast dev., increased team autonomy etc." /><link rel="canonical" href="/posts/msa-docker-kubernetes/" /><meta property="og:url" content="/posts/msa-docker-kubernetes/" /><meta property="og:site_name" content="Austin" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-30T06:00:25+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Relationship between MSA &amp; Docker(proceeding)" /><meta name="twitter:site" content="@ghkdqhrbals" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-30T06:00:25+00:00","datePublished":"2022-05-30T06:00:25+00:00","description":"MSA rises as cloud services and is more and more used. That’s because each service is independent and can be managed its cost efficiently. Also, even without the benefits of cost in cloud service, MSA has advantage of scalability, fast dev., increased team autonomy etc.","headline":"Relationship between MSA &amp; Docker(proceeding)","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/msa-docker-kubernetes/"},"url":"/posts/msa-docker-kubernetes/"}</script><title>Relationship between MSA & Docker(proceeding) | Austin</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Austin"><meta name="application-name" content="Austin"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/avatar/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Austin</a></div><div class="site-subtitle font-italic"> Record every seconds</div><div class="site-subtitle"> <a href="https://ghkdqhrbals.github.io/portfolios/" class="mx-auto" style="color: #ffd700"> See my portfolio </a></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>정보</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ghkdqhrbals" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ghkdqhrbals','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>Relationship between MSA & Docker(proceeding)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4 pb-5"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Relationship between MSA & Docker(proceeding)</h1><div class="post-meta text-muted"> <span> 게시 <em class="" data-ts="1653890425" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-05-30 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/ghkdqhrbals">ghkdqhrbals</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1267 단어"> <em>7 분</em>읽는 시간</span></div></div></div><div class="post-content"><p>MSA rises as <strong>cloud services</strong> and is more and more used. That’s because each service is independent and can be managed its cost efficiently. Also, even without the benefits of cost in cloud service, MSA has advantage of scalability, fast dev., increased team autonomy etc.</p><p>As each service of MSA has their independent environments, <strong>(1) Consistent environmental management(Portability)</strong> is required. Docker solves this for you!</p><blockquote><ul><li>VM : complicate for example, just in case you want to upgrade the version of your program. With VM, you need to pull from registry, update all configuration files, reset environments, etc. So it is very hard to change or update your program<li>Docker : easy Docker can simplify this process. Download image, run it!</ul></blockquote><p>Also Docker can gives you more advantages. Docker can run your application <strong>(2) fast in Provisioning &amp; starting</strong>, <strong>(3) light-weight</strong> than VM. This is because Docker based on OS-level process isolation rather than hardware virtualization(VM).</p><blockquote class="prompt-info"><div><p><img data-src="../../assets/p/6/Docker_VM.png" alt="a" data-proofer-ignore> containers provide OS-level process isolation whereas virtual machines offer isolation at the hardware abstraction layer (i.e., hardware virtualization). So in IaaS use cases machine virtualization is an ideal fit, while containers are best suited for packaging/shipping portable and modular software reference : <a href="https://www.upguard.com/blog/docker-vs-vmware-how-do-they-stack-up"><strong>https://www.upguard.com/blog/docker-vs-vmware-how-do-they-stack-up</strong></a></p></div></blockquote><blockquote><p>for example, if you want to input ‘hellow world’ in your Golang program.</p><ul><li><strong>VM</strong> first seperate hardware space in your Host and install GuestOS(which is very big size). Next install Golang compiler, run program, I/O execution. At this time, there is transition between GuestOS and HostOS by its I/O driver.<li><strong>Docker</strong> only install in container with bin/lib files that needed for executing program(unlike VM need whole OS which is very big size). That means Docker has light-weight. Also container and HostOS share some parts of kernel which don’t need I/O translation. Thus, speed of Docker is more faster than VM.</ul><p>Details in my posting : ‘<strong>Docker vs Virtual Machine</strong>’</p></blockquote><p>To summary, Docker has many advatages. But if you have many many containers, how can we manage all these containers?</p><p>Here is two container orchestration technology options, Docker-compose and Kubernetes.</p><blockquote><p>They both can manage cpu-usage, memory-usage, etc.</p></blockquote><hr /><h1 id="docker-compose"><strong>Docker-compose</strong></h1><ul><li>Docker Compose is a tool for defining and running multi-container Docker applications used in <strong>single host</strong>!<blockquote><p>I usally set my docker configuration with docker-compose. I use this in (1) portfolio project, (2) golang-backend project. My projects have features below. <strong>You can check docker-compose setting in my other posting</strong>. <img data-src="../../assets/p/6/2.png" alt="a" data-proofer-ignore> <img data-src="../../assets/p/6/1.png" alt="a" data-proofer-ignore></p></blockquote></ul><div file="golang-backend/docker-compose.yaml" class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="golang-backend/docker-compose.yaml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="na">services</span><span class="pi">:</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:12-alpine</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=root</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=secret</span>
      <span class="pi">-</span> <span class="s">POSTGRES_DB=simple_bank</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span> <span class="c1"># purpose to exposeing ports. Except this ports, you can use only inside services</span>
  <span class="na">api</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:8080"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">DB_SOURCE=postgresql://root:secret@postgres:5432/simple_bank?sslmode=disable</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">postgres</span>
    <span class="na">entrypoint</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/app/wait-for-it.sh"</span><span class="pi">,</span><span class="s2">"</span><span class="s">postgres:5432"</span><span class="pi">,</span><span class="s2">"</span><span class="s">--"</span><span class="pi">,</span><span class="s2">"</span><span class="s">/app/start.sh"</span><span class="pi">]</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/app/main"</span><span class="pi">]</span>
</pre></table></code></div></div><div file="portfolio/docker-compose.yaml" class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="portfolio/docker-compose.yaml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./nginx</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>

  <span class="na">client</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">client</span>
    <span class="na">expose</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">on-failure"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">PORT=3000</span>
      <span class="pi">-</span> <span class="s">NODE_ENV=development</span>
      <span class="pi">-</span> <span class="s">CHOKIDAR_USEPOLLING=true</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./client</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">./client/:/app"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/app/node_modules"</span>
    <span class="na">stdin_open</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">frontend</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">frontend</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span>
</pre></table></code></div></div><hr /><h1 id="kubernetes"><strong>Kubernetes</strong></h1><ul><li>Kubernetes is a platform for managing containerized workloads and services, that facilitates both declarative configuration and automation<blockquote><p>if you run your service in single host, you don’t need to use kubernetes. But if you want to run your service in multiple-host and take leverage in automation, you can use Kubernetes for your convenience.</p></blockquote></ul><p><img data-src="../../assets/p/6/kubernetes_detail.png" alt="a" data-proofer-ignore></p><p>Now, I will explain each components.</p><h2 id="components"><span class="mr-2">Components</span><a href="#components" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><dl><dt><code class="language-plaintext highlighter-rouge">Cluster</code><dd><code class="language-plaintext highlighter-rouge">Cluster</code> is a set of <code class="language-plaintext highlighter-rouge">Controll Plane</code> and one or more <code class="language-plaintext highlighter-rouge">Worker Node</code>.</dl><ul><li><dl><dt><code class="language-plaintext highlighter-rouge">Controll Plane</code><dd>also called <code class="language-plaintext highlighter-rouge">Master Node</code>. And it manages the <code class="language-plaintext highlighter-rouge">Worker Node</code>s and the <code class="language-plaintext highlighter-rouge">Pod</code>s in the cluster.</dl><ul><li><dl><dt><code class="language-plaintext highlighter-rouge">API server</code><dd>entry point for REST/kubectl</dl><li><dl><dt><code class="language-plaintext highlighter-rouge">Scheduler</code><dd>schedules pods to worker nodes</dl><li><dl><dt><code class="language-plaintext highlighter-rouge">Controll Manager</code><dd>it manages and watches their current state of <code class="language-plaintext highlighter-rouge">Worker Node</code>, <code class="language-plaintext highlighter-rouge">Pod</code></dl><li><dl><dt><code class="language-plaintext highlighter-rouge">etcd</code>(key-value store)<dd>stores all of Kubernetes cluster data(cluster state and config)</dl></ul><li><code class="language-plaintext highlighter-rouge">Worker Node</code> :maintain running <code class="language-plaintext highlighter-rouge">Pod</code> and provide the Kubernetes runtime environment<ul><li><dl><dt><code class="language-plaintext highlighter-rouge">kubelet</code><dd>It makes sure that containers are running in a Pod and they are healthy<dd>Path between API server of <code class="language-plaintext highlighter-rouge">Controll Plane</code></dl><li><dl><dt><code class="language-plaintext highlighter-rouge">kube-proxy</code><dd>manages IP translation and routing<dd>It facilitating Kubernetes networking services and load-balancing across all pods in a service</dl><li><dl><dt><code class="language-plaintext highlighter-rouge">Container runtime</code><dd>It pulls images from <code class="language-plaintext highlighter-rouge">Container Registry</code> and starts and stops containers<blockquote><p><code class="language-plaintext highlighter-rouge">Container Registry</code> : can be <code class="language-plaintext highlighter-rouge">Docker Hub</code>, <code class="language-plaintext highlighter-rouge">Amazon Elastic Container Registry(ECR)</code>, <code class="language-plaintext highlighter-rouge">Google Container Registry(GCR)</code></p></blockquote></dl></ul></ul></ul><h2 id="types-of-yaml-used-in-kubernetes"><span class="mr-2">Types of yaml used in Kubernetes</span><a href="#types-of-yaml-used-in-kubernetes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><blockquote class="prompt-info"><div><p>To run kubernetes, we need to set configuration files with yaml format. There are various type. <code class="language-plaintext highlighter-rouge">Deployment</code>, <code class="language-plaintext highlighter-rouge">Service</code>, <code class="language-plaintext highlighter-rouge">Ingress</code>, <code class="language-plaintext highlighter-rouge">ClusterIssuer</code>, etc.</p></div></blockquote><h3 id="deployment"><span class="mr-2">Deployment</span><a href="#deployment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>: A <code class="language-plaintext highlighter-rouge">deployment</code> type is responsible for keeping a set of pods running. Here is an example of deployment.yaml</p><div file="deployment.yaml" class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="deployment.yaml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">golang-backend-api-deployment</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">golang-backend-api</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">golang-backend-api</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">golang-backend-api</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">golang-backend-api</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">ghkdqhrbals/simplebank:latest</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">Always</span>
        <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DB_SOURCE</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s">postgresql://root:secret@postgres:5432/simple_bank?sslmode=disable</span>
</pre></table></code></div></div><ul><li>apiVersion : set api version. Here is a organized API information<a href="https://matthewpalmer.net/kubernetes-app-developer/articles/kubernetes-apiversion-definition-guide.html">https://matthewpalmer.net/kubernetes-app-developer/articles/kubernetes-apiversion-definition-guide.html</a><li>kind : this is a type of configuration<li>metadata : store resource label, name<li>spec : details of components<ul><li>replicas : set the number of <code class="language-plaintext highlighter-rouge">pod</code><li>selector : what will deployment want to replicate(<strong>find in <code class="language-plaintext highlighter-rouge">template</code></strong>)<li>template.spec.container : (1) find <code class="language-plaintext highlighter-rouge">ghkdqhrbals/simplebank:latest</code> Docker images from <strong>Docker Hub</strong>, (2) run container with name <code class="language-plaintext highlighter-rouge">golang-backend-api</code>, (3) set container port <code class="language-plaintext highlighter-rouge">8080</code></ul></ul><h3 id="service"><span class="mr-2">Service</span><a href="#service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>:A <code class="language-plaintext highlighter-rouge">service</code> is responsible for <strong>enabling network access to a set of pods</strong>.</p><blockquote><p>when you use only service, <strong>need to create pods passively</strong></p></blockquote><div file="service.yaml" class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="service.yaml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">golang-backend-api-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span> <span class="c1">#diff. LoadBalancer, etc.</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">golang-backend-api</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="c1"># nodePort is external access port outside the cluster. But, as we set type as clusterIP, this setting isn't needed</span>
      <span class="c1"># nodePort: 30131</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span> <span class="c1"># internal port</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span> <span class="c1"># forward port</span>
</pre></table></code></div></div><blockquote><p>reference from <a href="https://matthewpalmer.net/kubernetes-app-developer/articles/service-kubernetes-example-tutorial.html">https://matthewpalmer.net/kubernetes-app-developer/articles/service-kubernetes-example-tutorial.html</a></p></blockquote><ul><li>spec.type : you may choose within <code class="language-plaintext highlighter-rouge">ClusterIP</code> or <code class="language-plaintext highlighter-rouge">LoadBalancer</code> or <code class="language-plaintext highlighter-rouge">NodePort</code><ul><li>ClusterIP : The service is only accessible from within the Kubernetes cluster<blockquote><p>you can’t make requests to your <code class="language-plaintext highlighter-rouge">Pod</code> from outside the cluster</p></blockquote><li>NodePort : The service can handle requests that originate from outside the cluster<li>LoadBalancer : The service becomes accessible externally through a cloud provider’s load balancer functionality</ul></ul><p>In this case, (1) service get request from port:80 internally, (2) select pods with labeled <code class="language-plaintext highlighter-rouge">golang-backend-api</code>, (3) forward request to container port <code class="language-plaintext highlighter-rouge">8080</code> in golang-backend-api pod.</p><h3 id="ingress"><span class="mr-2">Ingress</span><a href="#ingress" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ingress exposes HTTP and HTTPS routes from outside the cluster to services within the cluster. Traffic routing is controlled by rules defined on the Ingress resource.</p><p><img data-src="../../assets/p/6/ingress.png" alt="a" data-proofer-ignore></p><div file="ingress.yaml" class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="ingress.yaml"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">IngressClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">controller</span><span class="pi">:</span> <span class="s">k8s.io/ingress-nginx</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">golang-backend-api-ingress</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">cert-manager.io/cluster-issuer</span><span class="pi">:</span> <span class="s">letsencrypt</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ingressClassName</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">api.hwangbogyumin.com"</span>
    <span class="na">http</span><span class="pi">:</span>
      <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span> <span class="c1"># 443, 80 etc. -&gt; 80 if "/" prefix</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/"</span>
        <span class="na">backend</span><span class="pi">:</span>
          <span class="na">service</span><span class="pi">:</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">golang-backend-api-service</span>
            <span class="na">port</span><span class="pi">:</span>
              <span class="na">number</span><span class="pi">:</span> <span class="m">80</span>
  <span class="na">tls</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">api.hwangbogyumin.com</span>
    <span class="na">secretName</span><span class="pi">:</span> <span class="s">hwangbogyumin-api.cert</span>
</pre></table></code></div></div><p><strong>~On proceeding…~</strong></p><blockquote><p><strong>I have been already finished this kubernetes works in AWS, not in on-premise. So, here i will set configuration in local environment</strong></p></blockquote><h1 id="references">References</h1><ul><li><a href="https://www.upguard.com/blog/docker-vs-vmware-how-do-they-stack-up">https://www.upguard.com/blog/docker-vs-vmware-how-do-they-stack-up</a><li><a href="https://stackoverflow.com/questions/47536536/whats-the-difference-between-docker-compose-and-kubernetes">https://stackoverflow.com/questions/47536536/whats-the-difference-between-docker-compose-and-kubernetes</a><li><a href="https://github.com/compose-spec/compose-spec/blob/master/spec.md">https://github.com/compose-spec/compose-spec/blob/master/spec.md</a><li><a href="https://www.theserverside.com/blog/Coffee-Talk-Java-News-Stories-and-Opinions/What-is-Kubernetes-vs-Docker-Compose-How-these-DevOps-tools-compare">https://www.theserverside.com/blog/Coffee-Talk-Java-News-Stories-and-Opinions/What-is-Kubernetes-vs-Docker-Compose-How-these-DevOps-tools-compare</a><li><a href="https://medium.com/devops-mojo/kubernetes-architecture-overview-introduction-to-k8s-architecture-and-understanding-k8s-cluster-components-90e11eb34ccd"><strong>https://medium.com/devops-mojo/kubernetes-architecture-overview-introduction-to-k8s-architecture-and-understanding-k8s-cluster-components-90e11eb34ccd</strong></a><li><a href="https://matthewpalmer.net/kubernetes-app-developer/articles/service-kubernetes-example-tutorial.html">https://matthewpalmer.net/kubernetes-app-developer/articles/service-kubernetes-example-tutorial.html</a><li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">https://kubernetes.io/docs/concepts/services-networking/ingress/</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%EC%84%9C%EB%B2%84/'>서버</a>, <a href='/categories/docker/'>Docker</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/msa/" class="post-tag no-text-decoration" >msa</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Relationship+between+MSA+%26+Docker%28proceeding%29+-+Austin&url=%2Fposts%2Fmsa-docker-kubernetes%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Relationship+between+MSA+%26+Docker%28proceeding%29+-+Austin&u=%2Fposts%2Fmsa-docker-kubernetes%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fmsa-docker-kubernetes%2F&text=Relationship+between+MSA+%26+Docker%28proceeding%29+-+Austin" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs-information/">CS information</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/msa/">msa</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/restful/">RESTFUL</a> <a class="post-tag" href="/tags/token/">token</a> <a class="post-tag" href="/tags/database/">database</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/micro-service-architecture2/"><div class="card-body"> <em class="small" data-ts="1662361225" data-df="YYYY-MM-DD" > 2022-09-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Advatage of MSA(Micro Service Architecture)</h3><div class="text-muted small"><p> What is MSA? Monolithic’s Disadvantage Changes in some modules affect the entire application Lack of scalability Micro Service Architecture’s Advantage Sca...</p></div></div></a></div><div class="card"> <a href="/posts/docker1/"><div class="card-body"> <em class="small" data-ts="1646888425" data-df="YYYY-MM-DD" > 2022-03-10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Docker Setting</h3><div class="text-muted small"><p> Dockerfile Below is my Banking Server backend Dockerfile. Here, I’m going to explain each steps. # Build stage FROM golang:1.18.3-alpine3.16 AS builder WORKDIR /app COPY ../.. . RUN go build -o m...</p></div></div></a></div><div class="card"> <a href="/posts/docker2/"><div class="card-body"> <em class="small" data-ts="1647147625" data-df="YYYY-MM-DD" > 2022-03-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Docker vs Virtual Machine</h3><div class="text-muted small"><p> Main difference between Docker and VM Size VM : large size To execute program, VM needs to have GuestOS which is very large size Docker : smal...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rsa/" class="btn btn-outline-primary" prompt="이전 글"><p>RSA ecnryption</p></a> <a href="/posts/npm-vs-yarn/" class="btn btn-outline-primary" prompt="다음 글"><p>NPM vs YARN, what is your favorite?</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs-information/">CS information</a> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/ethereum/">Ethereum</a> <a class="post-tag" href="/tags/msa/">msa</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/restful/">RESTFUL</a> <a class="post-tag" href="/tags/token/">token</a> <a class="post-tag" href="/tags/database/">database</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/ghkdqhrbals">ghkdqhrbals</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">새 버전의 콘텐츠를 사용할 수 있습니다.</p><button type="button" class="btn btn-primary" aria-label="Update"> 업데이트 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-VTR1DF5BPL"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-VTR1DF5BPL'); }); </script>
